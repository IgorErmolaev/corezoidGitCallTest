var fs = require('fs');
var json = fs.readFileSync(__dirname+'/../resource/purse_hbase_example.json').toString();
var data = JSON.parse(json).data;
//console.log(data);

/****************START*******************/
function is_array (a) {
    return (typeof a == "object") && (a instanceof Array);
}

const TREFTYPESALL = {"AB30":"ALT","AC30":"ALT","AD30":"ALT","AS30":"ALT","AU24":"AVTO","AUR7":"AVTO","AUR8":"AVTO","AUR9":"AVTO","AURL":"AVTO","AURM":"AVTO","AURN":"AVTO","AUTO":"AVTO","AUTR":"AVTO","AUBN":"AVTO","AUC3":"AVTO","AUC5":"AVTO","AUC7":"AVTO","AUF3":"AVTO","AUF5":"AVTO","AUF7":"AVTO","AUK3":"AVTO","AUK5":"AVTO","AUK7":"AVTO","AUR5":"AVTO","AUR6":"AVTO","INFB":"BAD","PPFB":"BAD","BDCD":"BAD","BDC1":"BAD","BCRU":"BON","BCRC":"BON","BCRG":"BON","BCRO":"BON","BOND":"BON","BONK":"BON","BTAM":"BON","PPB5":"CASH","PPB6":"CASH","PP10":"CASH","PP11":"CASH","PP12":"CASH","PPB7":"CASH","PPB8":"CASH","PPB9":"CASH","PPB4":"CASH","PRC1":"CASH","PPC1":"CASH","PPC2":"CASH","PPC3":"CASH","PPT1":"CASH","PPT2":"CASH","PPT3":"CASH","PPR1":"CASH","PPR2":"CASH","PPR3":"CASH","PPB1":"CASH","PPB2":"CASH","PPB3":"CASH","PAC1":"CASH","PAC2":"CASH","PAC3":"CASH","PAT1":"CASH","PAT2":"CASH","PAT3":"CASH","PAR1":"CASH","PAR2":"CASH","PAR3":"CASH","PAB1":"CASH","PAB2":"CASH","PAB3":"CASH","PRC2":"CASH","PRC3":"CASH","PRT1":"CASH","PRT2":"CASH","PRT3":"CASH","PRR1":"CASH","PRR2":"CASH","PRR3":"CASH","PRB2":"CASH","PRB3":"CASH","PGC1":"CASH","PGC2":"CASH","PGC3":"CASH","PGT1":"CASH","PGT2":"CASH","PGT3":"CASH","PGR1":"CASH","PGR2":"CASH","PGR3":"CASH","PGB1":"CASH","PGB2":"CASH","PGB3":"CASH","PLC1":"CASH","PLC2":"CASH","PLC3":"CASH","PLT1":"CASH","PLT2":"CASH","PLT3":"CASH","PLR1":"CASH","PLR2":"CASH","PLR3":"CASH","PLB1":"CASH","PLB2":"CASH","PLB3":"CASH","CRKA":"CASH","CRKD":"CASH","CRKC":"CASH","CRK1":"CASH","CRK2":"CASH","CRK3":"CASH","CRK4":"CASH","CRK5":"CASH","CRK6":"CASH","CR3L":"CASH","PRAV":"CASH","CRKE":"CASH","CRKB":"CASH","CRKM":"CASH","CRKQ":"CASH","CRKU":"CASH","CRSM":"CASH","MOTD":"CASS","CCOP":"CASS","VIB1":"CASS","CREC":"CEB","CRAG":"CEB","CRMB":"CEB","CRE1":"CEB","CRE3":"CEB","CREL":"CEB","CRLB":"CEB","CRSL":"CEB","CRT1":"CEB","CRT3":"CEB","CRPM":"CEB","TCIN":"DBTW","VVIP":"DBTW","ADK2":"DEB","DBK0":"DEB","DBKL":"DEB","MAC1":"DEB","MACL":"DEB","VDK2":"DEB","VEB2":"DEB","VFCO":"DEB","VFK2":"DEB","VFKL":"DEB","VFST":"DEB","VICL":"DEB","VIKF":"DEB","VIKU":"DEB","MPLS":"DEB","KMF2":"DEP","KMN2":"DEP","KMF4":"DEP","PRU2":"DEP","MDPZ":"DEP","KMB7":"DEP","KMB5":"DEP","KMFL":"DEP","KMB1":"DEP","KMF5":"DEP","KPN6":"DEP","KPM6":"DEP","KMN1":"DEP","KPN5":"DEP","KMN5":"DEP","KMF1":"DEP","015":"DEP","EKOM":"EKOM","CRB1":"FACH","GOL1":"GD_L","GDML":"GD_L","GDMR":"GD_L","GM2O":"GD_L","GM2L":"GD_L","GY2O":"GD_L","GY2L":"GD_L","G2MO":"GD_L","G2YO":"GD_L","G2ML":"GD_L","G2YL":"GD_L","G2MF":"GD_L","G2YF":"GD_L","GDYL":"GD_L","GDYO":"GD_L","GMPL":"GD_L","GOLD":"GD_L","GYPL":"GD_L","GYPO":"GD_L","GY2M":"GD_L","CLGD":"GD_M","GDMB":"GD_M","CLGV":"GD_M","GDMW":"GOLD","CLG6":"GOLD","BOEG":"GOLD","CLGB":"GOLD","CLGL":"GOLD","KLGB":"GOLD","UGKM":"GOLD","KRKM":"GOLD","CRKG":"GOLD","CLGP":"GOLD","KLG5":"GOLD","CLFL":"GOLD","CLTF":"GOLD","CROZ":"GOLD","UGK1":"GOLD","FLUB":"GOLD","GL1Y":"GOLD","GL2Y":"GOLD","CRCZ":"GOLD","CRCG":"GOLD","CLUB":"GOLD","CLKL":"GOLD","CRBG":"GOLD","CLBL":"GOLD","CLDF":"GOLD","CL55":"GOLD","CRGM":"GOLD","FAM3":"GOLD","CRGS":"GOLD","CLBG":"GOLD","CLGM":"GOLD","CLFF":"GOLD","CLG5":"GOLD","UGD2":"GOLD","UGD4":"GOLD","UGI2":"GOLD","UGI4":"GOLD","UGK4":"GOLD","UGM4":"GOLD","UGN4":"GOLD","UGN6":"GOLD","UGP2":"GOLD","UGP4":"GOLD","UGT2":"GOLD","UGT3":"GOLD","UGU4":"GOLD","GL2E":"GOLD","UGK2":"GOLD","UGM2":"GOLD","UGMS":"GOLD","UGU2":"GOLD","UNG3":"GOLD","UCRG":"GOLD","CRAB":"GOLD","PIW1":"INT","PIW2":"INT","PIWE":"INT","ICGD":"INT","ICED":"INT","ISVP":"INT","KRCU":"JUNI","CRCR":"JUNI","CRCP":"JUNI","CRCU":"JUNI","RAZ3":"KB","RAZV":"KB","RAZ1":"KB","RAZ2":"KB","ACCB":"KCPK","ACCD":"KCPK","ACCS":"KCPK","ACCA":"KCPK","ACCU":"KCPK","KPM0":"KORP","ABGT":"KORP","BBBC":"KORP","KGS3":"KORP","KGSL":"KORP","MBSH":"KORP","MCGL":"KORP","MCGT":"KORP","MCMB":"KORP","MGLH":"KORP","MGML":"KORP","VABH":"KORP","VB00":"KORP","VBAL":"KORP","VBAZ":"KORP","VBC0":"KORP","VBEZ":"KORP","VBGT":"KORP","VBL7":"KORP","VBPS":"KORP","VGF1":"KORP","VGFB":"KORP","VGFT":"KORP","VPBK":"KORP","VWOM":"KORP","ZHD":"KORP","ZHDC":"KORP","ZHDP":"KORP","TEHC":"KORP","VEBB":"KORP","VEBS":"KORP","VEBV":"KORP","VEML":"KORP","VGBL":"KORP","VGC5":"KORP","VGFL":"KORP","VGFV":"KORP","VGSL":"KORP","CBY$":"KORP","CBYH":"KORP","VBG2":"KORP","ABV1":"KORP","ABV2":"KORP","ABV3":"KORP","ABVB":"KORP","PRK6":"KORP","BBD7":"KORP","PRK0":"KORP","PRKR":"KORP","KGL3":"KORP","MCBS":"KORP","VBAI":"KORP","VBSL":"KORP","VBWS":"KORP","VGFS":"KORP","BBC":"KORP","BBCM":"KORP","VBE":"KORP","BBCS":"KORP","ITIN":"KORP","ABGS":"KORP","CMBM":"KORP","CMBB":"KORP","VCCZ":"KORP","COMF":"KORP","CBC6":"KORP","CEBD":"KORP","BBK":"KORP","CMB":"KORP","CMBS":"KORP","MCB":"KORP","MCG":"KORP","MCGS":"KORP","VBCN":"KORP","VBG":"KORP","VBGL":"KORP","VBNS":"KORP","CBUS":"KORP","CDIS":"KORP","CMB1":"KORP","CMB2":"KORP","CML":"KORP","CRBD":"KORP","CRBL":"KORP","DIST":"KORP","MCCL":"KORP","MECS":"KORP","NEST":"KORP","VABL":"KORP","VAPL":"KORP","VBA1":"KORP","VBA2":"KORP","VBAD":"KORP","VBAP":"KORP","VBAW":"KORP","VBCL":"KORP","VBCW":"KORP","VBE1":"KORP","VBE2":"KORP","VBEL":"KORP","VBGW":"KORP","VBL1":"KORP","VBL3":"KORP","VBW6":"KORP","VBW7":"KORP","VCHP":"KORP","VEBL":"KORP","VEMC":"KORP","VEMW":"KORP","VIBL":"KORP","VLW4":"KORP","AMBM":"KORP","BBCK":"KORP","BBCL":"KORP","BBPB":"KORP","BELC":"KORP","BOBB":"KORP","CBES":"KORP","CEDB":"KORP","CMB3":"KORP","CMBD":"KORP","CMBE":"KORP","CMBG":"KORP","CMBK":"KORP","CMBL":"KORP","CML1":"KORP","COMP":"KORP","COMS":"KORP","COMZ":"KORP","COPV":"KORP","CRBB":"KORP","CRBK":"KORP","CVBE":"KORP","DMEZ":"KORP","MCBA":"KORP","MCBC":"KORP","MCBL":"KORP","MCGM":"KORP","MCMC":"KORP","MCML":"KORP","VABZ":"KORP","VACL":"KORP","VADL":"KORP","VAPV":"KORP","VB1L":"KORP","VBAC":"KORP","VBBC":"KORP","VBBM":"KORP","VBBU":"KORP","VBC":"KORP","VBCH":"KORP","VBCS":"KORP","VBCU":"KORP","VBDA":"KORP","VBDL":"KORP","VBEK":"KORP","VBEN":"KORP","VBES":"KORP","VBGC":"KORP","VBGH":"KORP","VBGP":"KORP","VBGS":"KORP","VBIL":"KORP","VBL2":"KORP","VBL4":"KORP","VBL5":"KORP","VBL6":"KORP","VBL8":"KORP","VBOB":"KORP","VBOC":"KORP","VBSV":"KORP","VBW5":"KORP","VBWP":"KORP","UKK4":"KORP","PAVM":"KRED","CRKK":"KRED","HOCR":"KRED","MOBL":"KRED","PNET":"KRED","BFMC":"LICH","VIKP":"LICH","VIKT":"LICH","VEST":"LICH","VIE1":"LICH","VIKS":"LICH","AIK2":"LICH","BOI3":"LICH","ROVL":"LICH","MINS":"LICH","STMG":"LICH","BFMP":"LICH","TRAV":"LICH","MGDP":"LICH","BFHM":"LICH","KRPD":"LICH","PRP1":"LICH","VI2K":"LICH","PRCV":"LICH","PREV":"LICH","VIK2":"LICH","PRE1":"LICH","PRG1":"LICH","VICK":"LICH","VIKL":"LICH","SEK2":"LICH","DBK1":"LICH","VNB1":"LICH","DBK2":"LICH","MACC":"LICH","PRGV":"LICH","ROVE":"LICH","VEEB":"LICH","VIC1":"LICH","MGC1":"LICH","MRML":"LICH","MRMR":"LICH","VNBP":"LICH","VKI2":"LICH","VKF2":"LICH","VILK":"LICH","VKFL":"LICH","VI2M":"LICH","ROVC":"LICH","MGCD":"LICH","MGCL":"LICH","LIQP":"LIQP","METR":"METR","MTRG":"METR","ECOM":"METR","OSKR":"METR","ROVS":"METR","CZ06":"METR","CZ09":"METR","CZ12":"METR","ÐœK12":"MICR","MICZ":"MICR","CR12":"MICR","CR36":"MICR","MK12":"MICR","MK24":"MICR","MIKM":"MICR","MKD1":"MICR","MKDB":"MICR","MTMK":"MICR","MICR":"MICR","NOTR":"NOTR","PRKV":"OBJC","PRKF":"OBJC","KVNL":"OBJC","GLMG":"OBJG","GLMF":"OBJG","PROO":"OBUC","CRS2":"OBUC","CRS3":"OBUC","CRS4":"OBUC","CRS5":"OBUC","CRRS":"OBUC","C0BN":"OBUC","C1BN":"OBUC","C2BN":"OBUC","C3BN":"OBUC","C4BN":"OBUC","C5BN":"OBUC","CABN":"OBUC","CRO0":"OBUC","CRO1":"OBUC","CRO2":"OBUC","CRO3":"OBUC","CRO4":"OBUC","CRO5":"OBUC","CROA":"OBUC","CRS0":"OBUC","CRS1":"OBUC","CRSA":"OBUC","CRST":"OBUC","CRPT":"PAYP","CRPO":"PAYP","ABPM":"PENS","PNOZ":"PENS","PEMG":"PENS","PENS":"PENS","PRGL":"PENS","ABPN":"PENS","PPMG":"PENS","PPMC":"PENS","CREM":"RAS","RPKA":"REST","RPKI":"REST","RM06":"REST","RM24":"REST","RS06":"REST","RS36":"REST","RS24":"REST","RS12":"REST","RS60":"REST",
    "RR06":"REST","RR12":"REST","RR24":"REST","RR36":"REST","RP03":"REST","RP06":"REST","RP12":"REST","RL03":"REST","RL06":"REST","SB03":"REST",
    "RK06":"RKST","RK12":"RKST","RK24":"RKST","RK36":"RKST","RSRT":"RS_N","RSRZ":"RS_N","RSTS":"RS_N","ROTC":"RS_N","RASR":"RS_N","RS01":"RS_N","RS02":"RS_N","RSNK":"RS_N","RSNT":"RS_N","RSNE":"RS_N","RSNX":"RS_N","RSNY":"RS_N","RSNZ":"RS_N","RSR1":"RS_N","RSR2":"RS_N","RSR5":"RS_N","RSRD":"RS_N","RSRL":"RS_N","PRS1":"RS_N","PRS2":"RS_N","PRS5":"RS_N","PRSL":"RS_N","RSBN":"RS_N","RSCB":"RS_N","RSN4":"RS_N","RSN8":"RS_N","RSNG":"RS_N","RSNM":"RS_N","RSP2":"RS_N","MKK3":"RS_N","MOM3":"RS_N","MOM7":"RS_N","MPA3":"RS_N","MR36":"RS_N","MIM3":"RS_N","MKK2":"RS_N","MOG2":"RS_N","MOM2":"RS_N","MOR2":"RS_N","MORA":"RS_N","MORD":"RS_N","MORG":"RS_N","MORI":"RS_N","MORK":"RS_N","MORM":"RS_N","MORO":"RS_N","MORP":"RS_N","MORT":"RS_N","MORU":"RS_N","MORZ":"RS_N","MRA2":"RS_N","MRD2":"RS_N","MRI2":"RS_N","MRK2":"RS_N","MRKK":"RS_N","MRP2":"RS_N","MRT2":"RS_N","MRU2":"RS_N","MRZ2":"RS_N","RSN1":"RS_V","RSN2":"RS_V","RSN3":"RS_V","RSN5":"RS_V","RSN6":"RS_V","RSN7":"RS_V","RSNB":"RS_V","RSNL":"RS_V","MKK7":"RS_V","MMMS":"RS_V","MOG3":"RS_V","MOG7":"RS_V","MOR3":"RS_V","MOR7":"RS_V","MRA3":"RS_V","MRD3":"RS_V","MRI3":"RS_V","MRI7":"RS_V","MRK3":"RS_V","MRP3":"RS_V","MRT3":"RS_V","MRU3":"RS_V","MRU7":"RS_V","MRUC":"RS_V","MRUK":"RS_V","MRUP":"RS_V","MRUT":"RS_V","MRZ3":"RS_V","BO01":"SEA","BOI1":"SEA","MSEA":"SEA","SEAA":"SEA","SEAP":"SEA","VIMA":"SEA","VIMO":"SEA","MRGD":"SEA","GDMO":"SEA","EVCR":"SOB","SOC6":"SOB","SOCB":"SOB","SOCC":"SOB","SOCR":"SOB","SOCS":"SOB","SOCT":"SOB","SOKR":"SOB","SOCP":"SOB","SOBN":"SOB","SOC3":"SOB","SOCG":"SOB","SOSY":"SOB","SOTR":"SOB","SKCR":"SOB","SOVR":"SOB","SOII":"SOB","SOOB":"SOB","SOSP":"SOB","SOAS":"SOB","SOMG":"SOC","SNBR":"SOC","SNB3":"SOC","SNB1":"SOC","SOMC":"SOC","SNB2":"SOC","SSK2":"SOC","SSK3":"STUD","P24V":"TEK","VP24":"TEK","P24M":"TEK","UMCT":"UMER","FNPI":"UNI","FNP2":"UNI","CRAC":"UNI","KMKR":"UNI","ROSS":"UNI","TAMC":"UNI","UCDC":"UNI","UCPT":"UNI","UCPL":"UNI","UCMB":"UNI","UCDN":"UNI","CRCI":"UNI","CRCS":"UNI","MCCR":"UNI","CRDF":"UNI","FRC3":"UNI","FRCL":"UNI","UMCL":"UNI","CHEK":"UNI","CRC1":"UNI","CRC2":"UNI","CRCA":"UNI","CRCB":"UNI","CRCC":"UNI","CRCD":"UNI","CRCE":"UNI","CRCF":"UNI","CRCH":"UNI","CRCK":"UNI","CRCL":"UNI","CRCJ":"UNI","CRCM":"UNI","CRCN":"UNI","CRCO":"UNI","CRCX":"UNI","CRCY":"UNI","NKMZ":"UNI","CRVP":"UNI","CRNE":"UNI","CRNN":"UNI","CRCQ":"UNI","CRCW":"UNI","CRMK":"UNI","CRM1":"UNI","CRNT":"UNI","CRCV":"UNI","CRZH":"UNI","NWTN":"UNI","FAM1":"UNI","FAM2":"UNI","UII2":"UNI","UII7":"UNI","UNA4":"UNI","UNIG":"UNI","UNII":"UNI","UNIU":"UNI","UNMP":"UNI","UNUA":"UNI","UNV5":"UNI","UPA2":"UNI","UII4":"UNI","UKK7":"UNI","UMG1":"UNI","UMMS":"UNI","UN14":"UNI","UN15":"UNI","UNCB":"UNI","UND2":"UNI","UND4":"UNI","UNG2":"UNI","UNG4":"UNI","UNG7":"UNI","UNI2":"UNI","UNI4":"UNI","UNI7":"UNI","UNID":"UNI","UNIK":"UNI","UNIM":"UNI","UNIO":"UNI","UNIP":"UNI","UNIT":"UNI","UNIV":"UNI","UNIZ":"UNI","UNK2":"UNI","UNK4":"UNI","UNKK":"UNI","UNM2":"UNI","UNM4":"UNI","UNM7":"UNI","UNP2":"UNI","UNP4":"UNI","UNT2":"UNI","UNT4":"UNI","UNU2":"UNI","UNU4":"UNI","UNU7":"UNI","UNV2":"UNI","UNV4":"UNI","UNZ2":"UNI","UNZ4":"UNI","UPA4":"UNI","UT2":"UNI","UT3":"UNI","UT4":"UNI","UKK2":"UNI","UCMC":"UNI","UCRC":"UNI","UCRN":"UNI","UCMN":"UNI","UCRK":"UNI","UCMP":"UNI","UCML":"UNI","UCMS":"UNI","UCMK":"UNI","UCMT":"UNI","MUT2":"UNI","UNPI":"UNI","MOB":"UNI","MOBS":"UNI","LAM1":"UN_M","LRVP":"UN_M","LRCX":"UN_M","LRCO":"UN_M","LRCN":"UN_M","LRCM":"UN_M","LRCL":"UN_M","LRCK":"UN_M","LRCJ":"UN_M","LRCH":"UN_M","LRCD":"UN_M","LRCC":"UN_M","LRCB":"UN_M","LRCA":"UN_M","LRC9":"UN_M","LRC3":"UN_M","LRC2":"UN_M","LRC1":"UN_M","LHEK":"UN_M","CRPL":"UN_M","KRC0":"UN_M","CRDE":"UN_M","CRIT":"UN_M","CRPR":"UN_M","KRC5":"UN_M","KRCP":"UN_M","OSCR":"UN_M","BOEC":"UN_M","KRC3":"UN_M","LAM3":"UN_M","LAM2":"UN_M","CRPC":"UN_M","KRPL":"UN_M","UCRB":"UN_M","CRU3":"UN_M","UCPE":"UN_M","CRC5":"UN_M","CRC4":"UN_M","CRBN":"UN_M","CRC9":"UN_M","CRC0":"UN_M","CRC3":"UN_M","CR10":"UN_M","UCRE":"UN_M","UCME":"UN_M","SMMS":"UN_M","VASH":"VASH","FRE3":"VIP","PN21":"VIP","LODM":"VIP","PN07":"VIP","PN20":"VIP","PN22":"VIP","WSDD":"VIP","UPG1":"VIP","EXID":"VIP","INPA":"VIP","INPI":"VIP","PF12":"VIP","PN01":"VIP","PN02":"VIP","PN03":"VIP","PN04":"VIP","PN05":"VIP","PN10":"VIP","PN11":"VIP","PN13":"VIP","PN17":"VIP","PN19":"VIP","WS0P":"VIP","WS5P":"VIP","PPFE":"VIP","UPGE":"VIP","PLPL":"VIP","VIPD":"VIP","EXIB":"VIP","MCF1":"VIP","INFD":"VIP","VIPI":"VIP","VIPP":"VIP","VIPW":"VIP","VIDL":"VIP","EXI2":"VIP","FOPP":"VIP","FOR1":"VIP","FOSS":"VIP","FRE2":"VIP","GLD7":"VIP","INFA":"VIP","LODB":"VIP","LOY2":"VIP","LOYD":"VIP","PPF2":"VIP","PPH2":"VIP","PV01":"VIP","PV02":"VIP","PV03":"VIP","PV04":"VIP","PV05":"VIP","PV06":"VIP","PV07":"VIP","PV08":"VIP","PV09":"VIP","PV10":"VIP","PV11":"VIP","PV12":"VIP","PV13":"VIP","PV14":"VIP","PV15":"VIP","PV16":"VIP","PV17":"VIP","PV18":"VIP","REP2":"VIP","UPGG":"VIP","UPGM":"VIP","PRB1":"VIP","KCPL":"VIP","FRGM":"VIP","KCBL":"VIP","CRVG":"VIP","FREG":"VIP","PPFT":"VIP","REPL":"VIP","EXIT":"VIP","FREE":"VIP","FORL":"VIP","LOYL":"VIP","UPGR":"VIP","INFI":"VIP","INFL":"VIP","MCWS":"VIP","MCWL":"VIP","MCWF":"VIP","WS55":"VIP","WS05":"VIP","WS00":"VIP","MGIN":"VIP","GVIP":"VIP","PPH0":"VIP","MGPL":"VIP","FORS":"VIP","FORP":"VIP","UPGF":"VIP","PPF1":"VIP","PPH1":"VIP","EXI1":"VIP","FRE1":"VIP","LOY1":"VIP","REP1":"VIP","VIPE":"VIP","MGVC":"VIPK","PM05":"VIPK","PM75":"VIPK","VGVC":"VIPK","VM05":"VIPK","WV05":"VIPK","WV75":"VIPK","VBYU":"VIPK","VBV7":"VIPK","VBW4":"VIPK","VKPL":"VIPK","KWSC":"VIPK","KPS3":"VIPK","KSIG":"VIPK","PPB0":"VIPK","PPBL":"VIPK","PPWK":"VIPK","PPWL":"VIPK","KPMC":"VIPK","PPBK":"VIPK","VBBE":"VIPK","VBV1":"VIPK","VBV2":"VIPK","VBV3":"VIPK","VBV5":"VIPK","VBVF":"VIPK","VBW1":"VIPK","VBW2":"VIPK","VBW3":"VIPK","VBWF":"VIPK","GOMG":"ZP","GOZP":"ZP","ZUSD":"ZP","ZZ02":"ZP","CLZP":"ZP","PDL1":"ZP","ABZS":"ZP","ZGB0":"ZP","ABZG":"ZP","ABGL":"ZP","CLMC":"ZP","ZPCM":"ZP","MGIM":"ZP","ZPMG":"ZP","GOMC":"ZP","ZPT1":"ZP","PSE2":"ZP","PSE1":"ZP","PRCL":"ZP","ACCI":"ZP","ZGB2":"ZP","ZEB2":"ZP","ZGK2":"ZP","ZGK0":"ZP","ZCB2":"ZP","MGZZ":"ZP","UTNS":"ZP","ZCK2":"ZP","ZPMC":"ZP","CMST":"ZP","CMSL":"ZP","ZCMC":"ZP","ZEK2":"ZP","ZCK0":"ZP","ABZP":"ZP","MGZD":"ZP","MGZ9":"ZP_R"};
const CURR = {"974":"BYR","756":"CHF","978":"EUR","826":"GBP","981":"GEL","985":"PLN","810":"RUR","980":"UAH","840":"USD","961":"XAG","959":"XAU"};

if (data.DATA_CRED == undefined) data.DATA_CRED = [];

if (data["__conveyor_api_array__"] != undefined && is_array(data["__conveyor_api_array__"])) {
    var arr = data["__conveyor_api_array__"];
    arr.sort ( function(cred1, cred2) {
            function compare_str_dec(str1, str2) {
                if (str1 == str2) return 0;
                else if (str1 < str2) {
                    return 1;
                } else return -1;
            }
            if (cred1.exdate === null && cred2.exdate === null) return 0;
            else if (cred1.exdate === null) return -1;
            else if (cred2.exdate === null) return 1;
            else {
                var month1 = cred1.exdate.substr(0,2);
                var year1 = cred1.exdate.substr(2,2);
                var month2 = cred2.exdate.substr(0,2);
                var year2 = cred2.exdate.substr(2,2);
                if (year1 != year2) {
                    return compare_str_dec(year1,year2);
                }
                else {
                    return compare_str_dec(month1,month2);
                }
            }
        }

    );
    var dataCredArray = [];
    var dataCredArrayRefFound = [];
    for (var i = 0; i<arr.length; i++ ){
        if (arr[i].idekbOwn == arr[i].idEkbPan && arr[i].isCard3rdFace != 'Y') {
            var dataCred = {};
            dataCred.PRODUCT =  TREFTYPESALL[arr[i].contract_type];
            dataCred.REFERENC = arr[i].refcontract;
            if (dataCredArrayRefFound.indexOf(dataCred.REFERENC) == -1 && dataCred.PRODUCT != undefined && ['TEK'].indexOf(dataCred.PRODUCT) == -1) {
                dataCred.BANK = arr[i].bank;
                if (arr[i].contract_state != null) {
                    if (["d","b"].indexOf(arr[i].contract_state) != -1) {
                        dataCred.STATE = "K";
                    } else if (arr[i].contract_state == "a") {
                        dataCred.STATE = "O";
                    } else {
                        dataCred.STATE = arr[i].contract_state.toUpperCase();
                    }
                } else dataCred.STATE = null;
                dataCred.TYPE = arr[i].contract_type;
                dataCred.CCY =  CURR[arr[i].currency];
                dataCred.LIMIT =  arr[i].credit_limit;
                dataCred.BAL =  arr[i].availbalance;
                if (data.toCurr != undefined && data.toCurr.hasOwnProperty(dataCred.CCY)) {
                    dataCred.LIMIT =  dataCred.LIMIT * data.toCurr[dataCred.CCY];
                    dataCred.BAL =  dataCred.BAL * data.toCurr[dataCred.CCY];
                }
                dataCredArrayRefFound.push(dataCred.REFERENC);
                dataCredArray.push(dataCred);
            }
        }
    }
    data.DATA_CRED = dataCredArray;
}
/****************END*******************/

console.log(data);