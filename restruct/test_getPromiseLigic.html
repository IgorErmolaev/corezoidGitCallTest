<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
<script>

    json = '{"data":{"LOCAL_INCOME_01":[],"bissyb_newBranch":{"2":"ODRM","3":"ODRG","A":"ODRV","R":"ODRR","T":"ODRP","L":"ODRK","M":"ODRL"},"getCosts":{"gpdif":"3586.88"},"DATA_DEBCARD":[],"DATA_RESTRUCT":[{"PAN":"88000601447445","RATE":36,"OVER_PROC":0,"CURR":"UAH","OVER_BODY":0,"NORM_COM":0,"PRODTYPE":"SHTR","OVER_COM":0,"FL_GD":2,"CTYPE":"SHTR","BANK":"PB","REFERENCE":"SAMDN33000725652959","NORM_BODY":3262.21,"SUMREPEX":0,"COMPLEX":"P48","BALCONTR":3262.21,"FINE":0,"RATEFINE":36,"EXAGE":-1,"NORM_PROC":0},{"PAN":"29092061643705","RATE":0.01,"OVER_PROC":11624.86,"CURR":"UAH","OVER_BODY":16506.9,"NORM_COM":0,"PRODTYPE":"CASH","OVER_COM":0,"FL_GD":2,"CTYPE":"CC","BANK":"AB","REFERENCE":"YX485Z@9846001","NORM_BODY":0,"SUMREPEX":0,"COMPLEX":"SYB","BALCONTR":16506.9,"FINE":416012.97,"RATEFINE":0,"EXAGE":1633,"NORM_PROC":0},{"PAN":"*****","RATE":30,"OVER_PROC":36610.07,"CURR":"UAH","OVER_BODY":14749.58,"NORM_COM":3772.5,"PRODTYPE":"UN_M","OVER_COM":0,"FL_GD":2,"CTYPE":"CRC0","BANK":"PB","REFERENCE":"SAMDN50000040126925","NORM_BODY":0,"SUMREPEX":"***","COMPLEX":"P48","BALCONTR":14749.58,"FINE":0,"RATEFINE":30,"EXAGE":1653,"NORM_PROC":1952.21},{"PAN":"88031800106256","RATE":36,"OVER_PROC":0,"CURR":"UAH","OVER_BODY":0,"NORM_COM":0,"PRODTYPE":"SHTR","OVER_COM":0,"FL_GD":2,"CTYPE":"SHTR","BANK":"AB","REFERENCE":"SAMAB01000001663935","NORM_BODY":8007.86,"SUMREPEX":0,"COMPLEX":"P48","BALCONTR":8007.86,"FINE":0,"RATEFINE":36,"EXAGE":-1,"NORM_PROC":0}],"getPromise":[{"refcontract":"SAMAB01000001663935 ","avans":"-800.78","cred":"-3395.01","difprc":"0.00","difcom":"0.00","diffine":"0.00"},{"refcontract":"SAMDN33000725652959 ","avans":"-326.22","cred":"-652.44","difprc":"0.00","difcom":"0.00","diffine":"0.00"},{"refcontract":"SAMDN50000040126925 ","avans":"-5657.55","cred":"-23841.61","difprc":"0.00","difcom":"0.00","diffine":"0.00"},{"refcontract":"YX485Z@9846001 ","avans":"-44273.81","cred":"0.00","difprc":"0.00","difcom":"0.00","diffine":"0.00"}],"LOCAL_BAL_ALL":[3262.21,444144.73,57084.36,8007.86],"LOCAL_BAL_PROC":[0,11624.86,38562.28,0],"LOCAL_BAL_COM":[0,0,3772.5,0],"LOCAL_BAL_BODY":[3262.21,16506.9,14749.58,8007.86],"LOCAL_BAL_FINE":[0,416012.97,0,0],"LOCAL_SUM_MANDATORY_PROC":[0,0,0,0],"LOCAL_SUM_POSSIBLY_PROC_FORGIVE":[0,0,0,0],"LOCAL_SUM_POSSIBLY_COM_FORGIVE":[0,0,0,0],"LOCAL_SUM_POSSIBLY_FINE_FORGIVE":[0,416012.97,0,0],"LOCAL_SUM_POSSIBLY_COM_PROC_FORGIVE":[0,0,8127.01858,0],"LOCAL_BAL_BODY_WITHOUT_SHTR":[0,16506.9,14749.58,0],"Ctype_BISSYB":{"PP":"3","PR":"R","ABZS":"L","CRKU":"R","CRCL":"L","ABZP":"L","CLGP":"L","A0":"T","ABZG":"L","CLGL":"3","VIK2":"3","GDMB":"3","A7":"T","Z1":"2","A8":"T","CRKC":"R","CLGD":"3","CLGB":"3","R0":"R","R1":"R","AA":"T","R2":"R","R3":"R","R4":"R","AD":"T","R5":"R","AE":"T","R6":"R","PAC3":"L","AF":"T","R7":"R","PAC2":"L","R8":"R","R9":"R","AJ":"T","AK":"T","LON":"2","PAT2":"L","AL":"T","PAT1":"L","AM":"T","AN":"T","UMCT":"L","RA":"R","RB":"R","AR":"T","RC":"R","LOS":"2","RD":"R","CRU3":"L","RE":"R","AT":"T","AU":"T","RG":"R","AV":"T","PAT3":"L","AW":"T","RH":"R","RJ":"R","AZ":"T","RK":"R","RL":"R","KRCU":"L","RM":"R","CEBD":"2","RN":"R","RP":"R","EXIT":"A","SOVR":"L","BA":"3","RR":"R","RS":"R","RU":"R","RV":"R","RX":"R","RY":"R","SK":"R","DBK1":"3","CA":"R","MGCD":"3","CC":"R","MGZD":"L","KL":"3","CD":"3","KP":"3","CK":"R","KS":"3","CM":"R","CN":"R","CO":"R","CLBL":"3","CS":"R","LG":"2","TP":"R","DE":"2","CROZ":"3","MA":"2","ME":"2","MM":"2","MO":"2","MR":"2","SHTN":"L","F1":"R","F2":"R","F3":"R","F4":"R","CLDF":"3","CRPL":"L","VK":"A","SHTR":"L","CRPC":"L","FD":"R","NL":"3","FF":"R","NN":"3","FG":"R","FI":"T","FJ":"T","PAB2":"L","PAB1":"L","PAB3":"L","G0":"T","FO":"R","G1":"T","G2":"T","FR":"R","FS":"R","CRAC":"3","FU":"R","CRAB":"3","G8":"T","ABGS":"L","FZ":"R","ABGL":"L","GA":"T","PAC1":"L","GB":"T","GD":"T","GE":"T","GF":"T","ON":"2","KLGB":"3","OO":"2","CRC3":"L","OP":"2","CRC0":"L","GK":"T","GL":"T","CRK6":"R","GM":"T","OU":"2","CRK5":"R","CRBL":"2","GN":"T","CRK4":"R","CRK3":"R","CLG5":"L","GP":"T","CRK2":"R","CRK1":"R","GR":"T","CRBG":"3","CRBD":"2","PAR2":"L","PAR1":"L","PAR3":"L"},"newCredArray":[{"ref":"SAMDN33000725652959","avans":326.22,"cred":652.44,"difprc":0,"difcom":0,"diffine":0},{"ref":"YX485Z@9846001","avans":44273.81,"cred":0,"difprc":0,"difcom":0,"diffine":0},{"ref":"SAMDN50000040126925","avans":5657.55,"cred":23841.61,"difprc":0,"difcom":0,"diffine":0},{"ref":"SAMAB01000001663935","avans":800.78,"cred":3395.01,"difprc":0,"difcom":0,"diffine":0}],"ECA_BRNM22":"ODH0","LOCAL_PAN_FLAG":"N","RES_DEBCARD_POGASH_TYPE":"","RES_DEBCARD_POGASHENIE":"","SID":"160816csb2isduld97km","idDict":95996,"newBranch":"ODRK","ref":"160812B1TT713164PDES","userID":8150,"PROD_CHAR_ADVANCEAMOUNT":10000,"APP_CUST_ID":11620360,"PROD_CHAR_TYPE":"RESTRUCT","APP_SOCSTATUS_CHILDNUMBER":0,"PROD_CHAR_BANK":"PB","APP_CUST_INN":"2976300699","APP_SOCSTATUS_RESIDENT":"UA","APP_MARITAL_MARITALCOND":"SINGLE","APP_CUST_GENDER":"M","PROD_CHAR_BRANCH":"OD87","APP_SOCSTATUS_EDUCATION":"HIG","APP_EMPL_SOCIALSTATUS":"UNEMP","PROD_SCHEME_TERM":12,"APP_CUST_BIRTHDAY":"19810627000000","urlCalback":"https://test-start.privatbank.ua:7355/Irbis/conveyor/restnbsm.json","urlSave":"http://rtdm.test.it.loc/RTDMApi/log/insert.json","urlBase":"https://rmsvc.privatbank.ua/service","PROD_CHAR_PAYMONTH":0,"LOCAL_TYPE_RESTR":2,"RES_CHAR_CRED_TYPE":"RP12","RES_PERSENT":1.083,"monthKoef":0.0893173,"RES_RS_NEW_CRED_TERM":12,"termWave":12,"LOCAL_ONE_PAY":"N","brnmFinish":"PB_O","LOCAL_MIN_SUM_COM":30,"LOCAL_MIN_NEW_CRED_SUM":50,"bankMax":"AB","ctypeMax":"SHTR","BISSYB":"L","flagClientPromise":"Y"}}';
    var data = JSON.parse(json).data;
/*
    data.LOCAL_BAL_ALL = new Array(10000,8000,7000);
    data.LOCAL_BAL_COM = new Array(1000,800,700);
    data.LOCAL_BAL_PROC = new Array(1000,800,700);
    data.LOCAL_BAL_FINE= new Array(1000,800,700);
*/
    //-------------------------------------------




    data.LOCAL_SUM_AVANS = 0;

    data.LOCAL_RS_OVER_COM_FORGIVE = new Array();
    data.LOCAL_RS_OVER_COM_REMAIN = new Array();
    data.LOCAL_RS_OVER_PROC_FORGIVE = new Array();
    data.LOCAL_RS_OVER_PROC_REMAIN = new Array();
    data.LOCAL_RS_FINE_FORGIVE = new Array();
    data.LOCAL_RS_FINE_REMAIN = new Array();
    data.LOCAL_RS_SUM_FORGIVE = new Array();
    data.LOCAL_RS_SUM_REMINE = new Array();
    data.LOCAL_RS_SHTR_FORGIVE = new Array();
    data.LOCAL_RS_SHTR_REMINE = new Array();

    for (var i = 0; i < data.newCredArray.length; i++) {
        data.LOCAL_SUM_AVANS += data.newCredArray[i].avans;
    }


    for (var i = 0; i < data.DATA_RESTRUCT.length; i++) {
        var diffSum = 0;
        data.LOCAL_RS_OVER_COM_FORGIVE.push(0);
        data.LOCAL_RS_OVER_COM_REMAIN.push(0);
        data.LOCAL_RS_OVER_PROC_FORGIVE.push(0);
        data.LOCAL_RS_OVER_PROC_REMAIN.push(0);
        data.LOCAL_RS_FINE_FORGIVE.push(0);
        data.LOCAL_RS_FINE_REMAIN.push(0);
        data.LOCAL_RS_SHTR_FORGIVE.push(0);
        data.LOCAL_RS_SHTR_REMINE.push(0);

        diffSum = data.LOCAL_BAL_ALL[i] - data.newCredArray[i].cred - data.newCredArray[i].avans;

        if (data.DATA_RESTRUCT[i].CTYPE != 'SHTR' && data.DATA_RESTRUCT[i].CTYPE != 'SHTN') {

            if (diffSum > 0) {
                if (data.LOCAL_BAL_COM[i] > 0) {
                    if (diffSum - data.LOCAL_BAL_COM[i] >= 0) {
                        data.LOCAL_RS_OVER_COM_FORGIVE[i] = data.LOCAL_BAL_COM[i];
                        data.LOCAL_RS_OVER_COM_REMAIN[i] = 0;
                        diffSum += -data.LOCAL_BAL_COM[i];
                    }
                    else {
                        data.LOCAL_RS_OVER_COM_FORGIVE[i] = diffSum;
                        data.LOCAL_RS_OVER_COM_REMAIN[i] = data.LOCAL_BAL_COM[i] - data.LOCAL_RS_OVER_COM_FORGIVE[i];
                        diffSum = 0;
                    }
                }
            }
            if (diffSum > 0) {
                if (data.LOCAL_BAL_PROC[i] > 0) {
                    if (diffSum - data.LOCAL_BAL_PROC[i] >= 0) {
                        data.LOCAL_RS_OVER_PROC_FORGIVE[i] = data.LOCAL_BAL_PROC[i];
                        data.LOCAL_RS_OVER_PROC_REMAIN[i] = 0;
                        diffSum += -data.LOCAL_BAL_PROC[i];
                    }
                    else {
                        data.LOCAL_RS_OVER_PROC_FORGIVE[i] = diffSum;
                        data.LOCAL_RS_OVER_PROC_REMAIN[i] = data.LOCAL_BAL_PROC[i] - data.LOCAL_RS_OVER_PROC_FORGIVE[i];
                        diffSum = 0;
                    }
                }
            }
            if (diffSum > 0) {
                if (data.LOCAL_BAL_FINE[i] > 0) {
                    if (diffSum - data.LOCAL_BAL_FINE[i] >= 0) {
                        data.LOCAL_RS_FINE_FORGIVE[i] = data.LOCAL_BAL_FINE[i];
                        data.LOCAL_RS_FINE_REMAIN[i] = 0;
                        diffSum += -data.LOCAL_BAL_FINE[i];
                    }
                    else {
                        data.LOCAL_RS_FINE_FORGIVE[i] = diffSum;
                        data.LOCAL_RS_FINE_REMAIN[i] = data.LOCAL_BAL_FINE[i] - data.LOCAL_RS_FINE_FORGIVE[i];
                        diffSum = 0;
                    }
                }
            }
            data.LOCAL_RS_SUM_FORGIVE.push(data.LOCAL_RS_OVER_COM_FORGIVE[i] + data.LOCAL_RS_OVER_PROC_FORGIVE[i] + data.LOCAL_RS_FINE_FORGIVE[i]);
            data.LOCAL_RS_SUM_REMINE.push(data.LOCAL_BAL_ALL[i] - data.LOCAL_RS_SUM_FORGIVE[i]);
        }
        else {
            data.LOCAL_RS_SHTR_FORGIVE[i] = diffSum;
            data.LOCAL_RS_SHTR_REMINE[i] = data.LOCAL_BAL_ALL[i] - data.LOCAL_RS_SHTR_FORGIVE[i];
            data.LOCAL_RS_SUM_FORGIVE.push(data.LOCAL_RS_SHTR_FORGIVE[i]);
            data.LOCAL_RS_SUM_REMINE.push(data.LOCAL_RS_SHTR_REMINE[i]);
        }


    }




</script>
</body>
</html>