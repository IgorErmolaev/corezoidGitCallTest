<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
<script>

    json = '{"data":{"getCosts":{"gpdif":0},"urlCalback":"https://start.privatbank.ua:7585/Irbis/conveyor/restnbsm.json","LOCAL_SUM_POSSIBLY_COM_PROC_FORGIVE":[1466,0],"getPromise":[{"result":"client not found"}],"RES_RS_TOTAL_COM_FORGIVE":2350,"APP_SOCSTATUS_EDUCATION":"SEC","BISSYB":"L","urlSave":"https://rtdm.it.loc/RTDMApi/log/insert.json","RES_RS_SHTR_REMINE":[0,168.51],"RES_RS_SHTR_FORGIVE":[0,393.17],"bankMax":"PB","RES_RS_TOTAL_SHTR_REMINE":168.51,"RES_RS_OVER_PROC_FORGIVE":[2815.13,0],"LOCAL_RS_CRED_FIRST_PAY_B":2382.13,"LOCAL_RS_NEW_CRED_PAYMONTH":0,"bissyb_newBranch":{"2":"LVRM","3":"LV1G","T":"LVRP","A":"LVRV","R":"LVRR","L":"LVRK","M":"LVRL"},"LOCAL_RS_SUM_FORGIVE":[5165.125,393.1749999999997],"termWave":0,"LOCAL_RS_TOTAL_SUM_REMINE":2382.13,"RES_RS_CURR":["UAH","UAH"],"RES_RS_NEW_CRED_FIRST_PAY":"2382.13","LOCAL_BAL_COM":[2350,0],"LOCAL_RS_OVER_COM_REMAIN":[0,0],"urlBase":"https://rmsvc.privatbank.ua/service","LOCAL_BAL_BODY":[1067.03,561.68],"LOCAL_BAL_FINE":[0,0],"ctypeMax":"SHTR","LOCAL_RS_OVER_COM_FORGIVE":[2350,0],"monthKoef":0,"LOCAL_INCOME_01":[],"RES_RS_NEW_CRED_TERM":0,"RES_RS_FINE_REMAIN":[0,0],"LOCAL_RS_SHTR_REMINE":[0,168.50500000000022],"LOCAL_RS_OVER_PROC_REMAIN":[1146.5950000000003,0],"LOCAL_RS_SUM_REMINE":[2213.625,168.50500000000022],"answerParam":"ok","RES_DEC_FINAL_FLOW":"ACCEPT","LOCAL_SUM_POSSIBLY_FINE_FORGIVE":[0,0],"LOCAL_BAL_BODY_WITHOUT_SHTR":[1067.03,0],"RES_RS_TOTAL_SUM_REMINE":2382.13,"LOCAL_MIN_SUM_COM":30,"RES_RS_OVER_COM_REMAIN":[0,0],"LOCAL_BAL_PROC":[3961.7200000000003,0],"LOCAL_SUM_MANDATORY_PROC":[0,0],"ECA_BRNM22":"LVH0","LOCAL_TYPE_RESTR":2,"newBranch":"LVRK","RES_RS_NEW_CRED_PAYMONTH":"0","brnmFinish":"","RES_RS_OVER_PROC_REMAIN":[1146.6,0],"LOCAL_SUM_POSSIBLY_PROC_FORGIVE":[0,0],"RES_RS_TOTAL_COM_REMINE":0,"RES_CHAR_CRED_TYPE":"CRPL","RES_DEBCARD_POGASHENIE":"","LOCAL_RS_TOTAL_SUM_FORGIVE":5558.299999999999,"LOCAL_RS_OVER_PROC_FORGIVE":[2815.125,0],"LOCAL_SUM_POSSIBLY_COM_FORGIVE":[0,0],"LOCAL_RS_FINE_FORGIVE":[0,0],"LOCAL_PAN_FLAG":"N","RES_RS_TOTAL_FINE_FORGIVE":0,"RES_RS_TOTAL_SHTR_FORGIVE":393.17,"APP_EMPL_SOCIALSTATUS":"UNEMP","RES_RS_SUM_REMINE":[2213.63,168.51],"RES_RS_TOTAL_FINE_REMINE":0,"LOCAL_RS_SHTR_FORGIVE":[0,393.1749999999997],"newCredArray":[],"RES_RS_TOTAL_SUM_FORGIVE":5558.3,"flagClientPromise":"N","userID":9241,"RES_DEBCARD_POGASH_TYPE":"","RES_RS_OVER_COM_FORGIVE":[2350,0],"LOCAL_ONE_PAY":"Y","PROD_CHAR_BRANCH_START":"LVRK","RES_RS_TOTAL_PROC_FORGIVE":2815.13,"RES_RS_TOTAL_PROC_REMINE":1146.6,"RES_PERSENT":0.001,"RES_BI":"N","RES_RS_FINE_FORGIVE":[0,0],"LOCAL_BAL_ALL":[7378.75,561.68],"RES_RESTRUCT_REFERENCE":["SAMDN50000061236012","SAMDN33000730362177"],"RES_RS_SUM_FORGIVE":[5165.13,393.17],"LOCAL_RS_NEW_CRED_SUM":2382.13,"RES_RS_NEW_CRED_SUM":"0","PROD_CHAR_PAYMONTH":0,"LOCAL_MIN_NEW_CRED_SUM":50,"ref":"160907B1DT992703TIWL","LOCAL_RS_FINE_REMAIN":[0,0],"DATA_RESTRUCT":[{"PAN":"5211537410703115","RATE":30,"OVER_PROC":3739.15,"CURR":"UAH","OVER_BODY":948.69,"NORM_COM":2350,"PRODTYPE":"UN_M","OVER_COM":0,"FL_GD":2,"CTYPE":"CRC0","BANK":"PB","REFERENCE":"SAMDN50000061236012","NORM_BODY":118.34,"SUMREPEX":0,"COMPLEX":"P48","BALCONTR":1067.03,"FINE":0,"RATEFINE":30,"EXAGE":1466,"NORM_PROC":222.57},{"PAN":"88009601654295","RATE":36,"OVER_PROC":0,"CURR":"UAH","OVER_BODY":0,"NORM_COM":0,"PRODTYPE":"SHTR","OVER_COM":0,"FL_GD":2,"CTYPE":"SHTR","BANK":"PB","REFERENCE":"SAMDN33000730362177","NORM_BODY":561.68,"SUMREPEX":0,"COMPLEX":"P48","BALCONTR":561.68,"FINE":0,"RATEFINE":36,"EXAGE":-1,"NORM_PROC":0}],"DATA_DEBCARD":[],"APP_CUST_BIRTHDAY":"19840805000000","PROD_SCHEME_TERM":0,"PROD_CHAR_BRANCH":"LVRK","APP_CUST_GENDER":"F","APP_MARITAL_MARITALCOND":"SINGLE","APP_SOCSTATUS_RESIDENT":"UA","APP_CUST_INN":"3089804220","PROD_CHAR_BANK":"PB","APP_SOCSTATUS_CHILDNUMBER":2,"PROD_CHAR_TYPE":"RESTRUCT","APP_CUST_ID":1005600751,"PROD_CHAR_ADVANCEAMOUNT":2382.13}}';
    var data = JSON.parse(json).data;



    data.RES_RS_FINE_FORGIVE = new Array();
    data.RES_RS_FINE_REMAIN= new Array();
    data.RES_RS_OVER_COM_FORGIVE= new Array();
    data.RES_RS_OVER_COM_REMAIN= new Array();
    data.RES_RS_OVER_PROC_FORGIVE= new Array();
    data.RES_RS_OVER_PROC_REMAIN= new Array();
    data.RES_RS_SHTR_FORGIVE= new Array();
    data.RES_RS_SHTR_REMINE= new Array();

    data.RES_RS_SUM_FORGIVE= new Array();
    data.RES_RS_SUM_REMINE= new Array();
    data.RES_RESTRUCT_REFERENCE= new Array();
    data.RES_RS_CURR= new Array();


    var RS_OVER_PROC_FORGIVE =0;
    var BAL_PROC=0;
    var RS_OVER_COM_FORGIVE=0;
    var BAL_COM=0;
    var RS_FINE_FORGIVE=0;
    var BAL_FINE=0;
    var RS_SHTR_FORGIVE=0;
    var RS_SHTR_REMINE =0;


    /*------------------the final decision----------------------*/
    data.RES_DEC_FINAL_FLOW = 'ACCEPT';

    if (data.RES_CHAR_CRED_TYPE == 'erro' || data.RES_CHAR_CRED_TYPE=='0' || data.LOCAL_RES_RS_NEW_CRED_SUM == 0){
        data.RES_DEC_FINAL_FLOW = 'DECLINE';
        data.RES_CHAR_CRED_TYPE = '';
        data.RES_RS_NEW_CRED_TERM = 0;
    }

    for (var i=0;i<data.LOCAL_RS_OVER_PROC_FORGIVE.length;i++){
        RS_OVER_PROC_FORGIVE += data.LOCAL_RS_OVER_PROC_FORGIVE[i];
        BAL_PROC += data.LOCAL_BAL_PROC[i];
        RS_OVER_COM_FORGIVE += data.LOCAL_RS_OVER_COM_FORGIVE[i];
        BAL_COM += data.LOCAL_BAL_COM[i];
        RS_FINE_FORGIVE += data.LOCAL_RS_FINE_FORGIVE[i];
        BAL_FINE += data.LOCAL_BAL_FINE[i];
    }

    for (var i=0;i<data.LOCAL_RS_SHTR_FORGIVE.length;i++){
        RS_SHTR_FORGIVE += data.LOCAL_RS_SHTR_FORGIVE[i];
        RS_SHTR_REMINE += data.LOCAL_RS_SHTR_REMINE[i];
    }

    /*------------calculating--total--sum-forgive and remine-------------*/
    data.RES_RS_TOTAL_PROC_FORGIVE = RS_OVER_PROC_FORGIVE;
    data.RES_RS_TOTAL_PROC_REMINE = BAL_PROC - data.RES_RS_TOTAL_PROC_FORGIVE;
    data.RES_RS_TOTAL_PROC_FORGIVE = Math.round(parseFloat(data.RES_RS_TOTAL_PROC_FORGIVE) * 100) / 100;
    data.RES_RS_TOTAL_PROC_REMINE = Math.round(parseFloat(data.RES_RS_TOTAL_PROC_REMINE) * 100) / 100;

    data.RES_RS_TOTAL_COM_FORGIVE = RS_OVER_COM_FORGIVE;
    data.RES_RS_TOTAL_COM_REMINE = BAL_COM - data.RES_RS_TOTAL_COM_FORGIVE;
    data.RES_RS_TOTAL_COM_FORGIVE = Math.round(parseFloat(data.RES_RS_TOTAL_COM_FORGIVE) * 100) / 100;
    data.RES_RS_TOTAL_COM_REMINE = Math.round(parseFloat(data.RES_RS_TOTAL_COM_REMINE) * 100) / 100;

    data.RES_RS_TOTAL_FINE_FORGIVE = RS_FINE_FORGIVE;
    data.RES_RS_TOTAL_FINE_REMINE = BAL_FINE - data.RES_RS_TOTAL_FINE_FORGIVE;
    data.RES_RS_TOTAL_FINE_FORGIVE = Math.round(parseFloat(data.RES_RS_TOTAL_FINE_FORGIVE) * 100) / 100;
    data.RES_RS_TOTAL_FINE_REMINE = Math.round(parseFloat(data.RES_RS_TOTAL_FINE_REMINE) * 100) / 100;

    data.RES_RS_TOTAL_SHTR_FORGIVE = RS_SHTR_FORGIVE;
    data.RES_RS_TOTAL_SHTR_REMINE = RS_SHTR_REMINE;
    data.RES_RS_TOTAL_SHTR_FORGIVE = Math.round(parseFloat(data.RES_RS_TOTAL_SHTR_FORGIVE) * 100) / 100;
    data.RES_RS_TOTAL_SHTR_REMINE = Math.round(parseFloat(data.RES_RS_TOTAL_SHTR_REMINE) * 100) / 100;

    data.RES_RS_TOTAL_SUM_FORGIVE = Math.round(parseFloat(data.LOCAL_RS_TOTAL_SUM_FORGIVE) * 100) / 100;
    data.RES_RS_TOTAL_SUM_REMINE = Math.round(parseFloat(data.LOCAL_RS_TOTAL_SUM_REMINE) * 100) / 100;


    /*--------------------RES array--------------------*/
    for (i=0; i<data.DATA_RESTRUCT.length;i++){
        if (data.DATA_RESTRUCT[i].REFERENCE != null){
            data.RES_RS_FINE_FORGIVE.push(data.LOCAL_RS_FINE_FORGIVE[i]);
            data.RES_RS_FINE_FORGIVE[i] = Math.round(parseFloat(data.RES_RS_FINE_FORGIVE[i]) * 100) / 100;
            data.RES_RS_FINE_REMAIN.push(data.LOCAL_RS_FINE_REMAIN[i]);
            data.RES_RS_FINE_REMAIN[i] = Math.round(parseFloat(data.RES_RS_FINE_REMAIN[i]) * 100) / 100;
            data.RES_RS_OVER_COM_FORGIVE.push(data.LOCAL_RS_OVER_COM_FORGIVE[i]);
            data.RES_RS_OVER_COM_FORGIVE[i] = Math.round(parseFloat(data.RES_RS_OVER_COM_FORGIVE[i]) * 100) / 100;
            data.RES_RS_OVER_COM_REMAIN.push(data.LOCAL_RS_OVER_COM_REMAIN[i]);
            data.RES_RS_OVER_COM_REMAIN[i] = Math.round(parseFloat(data.RES_RS_OVER_COM_REMAIN[i]) * 100) / 100;
            data.RES_RS_OVER_PROC_FORGIVE.push(data.LOCAL_RS_OVER_PROC_FORGIVE[i]);
            data.RES_RS_OVER_PROC_FORGIVE[i] = Math.round(parseFloat(data.RES_RS_OVER_PROC_FORGIVE[i]) * 100) / 100;
            data.RES_RS_OVER_PROC_REMAIN.push(data.LOCAL_RS_OVER_PROC_REMAIN[i]);
            data.RES_RS_OVER_PROC_REMAIN[i] = Math.round(parseFloat(data.RES_RS_OVER_PROC_REMAIN[i]) * 100) / 100;
            data.RES_RS_SHTR_FORGIVE.push(data.LOCAL_RS_SHTR_FORGIVE[i]);
            data.RES_RS_SHTR_FORGIVE[i] = Math.round(parseFloat(data.RES_RS_SHTR_FORGIVE[i]) * 100) / 100;
            data.RES_RS_SHTR_REMINE.push(data.LOCAL_RS_SHTR_REMINE[i]);
            data.RES_RS_SHTR_REMINE[i] = Math.round(parseFloat(data.RES_RS_SHTR_REMINE[i]) * 100) / 100;

            data.RES_RS_SUM_FORGIVE.push(data.LOCAL_RS_SUM_FORGIVE[i]);
            data.RES_RS_SUM_FORGIVE[i] = Math.round(parseFloat(data.RES_RS_SUM_FORGIVE[i]) * 100) / 100;
            data.RES_RS_SUM_REMINE.push(data.LOCAL_RS_SUM_REMINE[i]);
            data.RES_RS_SUM_REMINE[i] = Math.round(parseFloat(data.RES_RS_SUM_REMINE[i]) * 100) / 100;
            data.RES_RESTRUCT_REFERENCE.push(data.DATA_RESTRUCT[i].REFERENCE);
            data.RES_RS_CURR.push(data.DATA_RESTRUCT[i].CURR);

        }
    }

    data.RES_BI = 'N';

    data.LOCAL_RS_NEW_CRED_SUM = Math.round(parseFloat(data.LOCAL_RS_NEW_CRED_SUM) * 100) / 100;
    data.RES_RS_NEW_CRED_SUM = String(data.LOCAL_RS_NEW_CRED_SUM);
    data.LOCAL_RS_CRED_FIRST_PAY_B = Math.round(parseFloat(data.LOCAL_RS_CRED_FIRST_PAY_B) * 100) / 100;
    data.RES_RS_NEW_CRED_FIRST_PAY = String(data.LOCAL_RS_CRED_FIRST_PAY_B);
    data.LOCAL_RS_NEW_CRED_PAYMONTH = Math.round(parseFloat(data.LOCAL_RS_NEW_CRED_PAYMONTH) * 100) / 100;
    data.RES_RS_NEW_CRED_PAYMONTH = String(data.LOCAL_RS_NEW_CRED_PAYMONTH);



    if (data.PROD_SCHEME_TERM == 6 && data.LOCAL_ONE_PAY == 'Y' && (data.PROD_CHAR_BANK== 'PB' || data.PROD_CHAR_BANK== 'AB')) {
        data.PROD_SCHEME_TERM = 0;
        data.RES_CHAR_CRED_TYPE = 'CRPL';
        data.LOCAL_RS_CRED_FIRST_PAY_B = data.RES_RS_NEW_CRED_SUM;
        data.RES_RS_NEW_CRED_FIRST_PAY = String(data.LOCAL_RS_CRED_FIRST_PAY_B);
        data.RES_RS_NEW_CRED_SUM = '0';
        data.RES_RS_NEW_CRED_PAYMONTH = '0';
        data.RES_RS_NEW_CRED_TERM = 0;
    }
    //delete data.DATA_RESTRUCT;
    //delete data.DATA_DEBCARD;

    data.PROD_CHAR_BRANCH_START = data.PROD_CHAR_BRANCH;

    if (data.newBranch != undefined && data.newBranch!= ''){
        data.PROD_CHAR_BRANCH = data.newBranch;
    }


</script>
</body>
</html>